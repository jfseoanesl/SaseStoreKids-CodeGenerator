<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de C√≥digos de Productos con SQLite</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß∏ Generador de C√≥digos de Productos</h1>
            <p>Sistema completo con base de datos SQLite integrada</p>
            <div class="db-status">
                <div class="status-indicator"></div>
                <span id="dbStatusText">Conectando a base de datos...</span>
            </div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" data-tab="generator" onclick="switchTab('generator')">üìù Generador</button>
                <button class="tab" data-tab="products" onclick="switchTab('products')">üìã Productos</button>
                <button class="tab" data-tab="reports" onclick="switchTab('reports')">üìä Reportes</button>
                <button class="tab" data-tab="config" onclick="switchTab('config')">‚öôÔ∏è Configuraci√≥n</button>
                <button class="tab" data-tab="database" onclick="switchTab('database')">üóÑÔ∏è Base de Datos</button>
            </div>

            <!-- TAB GENERADOR -->
            <div id="generator" class="tab-content active">
                <div class="generator-section">
                    <h3>‚ú® Generar Nuevo Producto</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="tipo">Tipo de Producto:</label>
                            <select id="tipo" onchange="updateSubcategories()">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categor√≠a:</label>
                            <select id="categoria" onchange="updateSubcategories()">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="subcategoria">Subcategor√≠a:</label>
                            <select id="subcategoria">
                                <option value="">Seleccionar categor√≠a primero...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="talla">Talla:</label>
                            <select id="talla">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="color">Color:</label>
                            <select id="color">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="temporada">Temporada:</label>
                            <select id="temporada">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="generateCode()">üéØ Generar C√≥digo</button>
                    </div>
                </div>

                <div class="result-section" id="resultSection" style="display: none;">
                    <h3>üìä C√≥digo y Nombre Generados</h3>
                    <div class="code-display" id="generatedCode">-</div>
                    <div class="name-display" id="generatedName">-</div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveProduct()">üíæ Guardar Producto</button>
                        <button class="btn btn-primary" onclick="generateNewCode()">üîÑ Generar Nuevo</button>
                    </div>
                </div>

                <div id="alertContainer"></div>
            </div>

            <!-- TAB PRODUCTOS -->
            <div id="products" class="tab-content">
                <div class="search-section">
                    <h4>üîç Buscar Productos</h4>
                    <div class="search-form">
                        <input type="text" id="searchInput" placeholder="Buscar por c√≥digo, nombre, categor√≠a...">
                        <button class="btn btn-primary" onclick="searchProducts()">Buscar</button>
                        <button class="btn btn-warning" onclick="clearSearch()">Limpiar</button>
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üìã Productos Registrados</h3>
                    <div>
                        <button class="btn btn-primary" onclick="exportToCSV()">üì§ Exportar CSV</button>
                        <button class="btn btn-warning" onclick="exportToJSON()">üì§ Exportar JSON</button>
                    </div>
                </div>
                <div id="productsContainer">
                    <p>Cargando productos...</p>
                </div>
            </div>

            <!-- TAB REPORTES -->
            <div id="reports" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalProducts">0</div>
                        <div class="stat-label">Total Productos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCategories">0</div>
                        <div class="stat-label">Categor√≠as</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalColors">0</div>
                        <div class="stat-label">Colores √önicos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lastCode">-</div>
                        <div class="stat-label">√öltimo C√≥digo</div>
                    </div>
                </div>
                
                <div class="config-section">
                    <h3>üìà Reportes Detallados</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="generateCategoryReport()">Reporte por Categor√≠as</button>
                        <button class="btn btn-primary" onclick="generateColorReport()">Reporte por Colores</button>
                        <button class="btn btn-primary" onclick="generateSizeReport()">Reporte por Tallas</button>
                        <button class="btn btn-primary" onclick="generateSeasonReport()">Reporte por Temporadas</button>
                    </div>
                </div>
                
                <div id="reportResults"></div>
            </div>

            <!-- TAB CONFIGURACI√ìN -->
            <div id="config" class="tab-content">
                <div class="config-section">
                    <h3>‚öôÔ∏è Configuraci√≥n del Sistema</h3>
                    <div class="config-grid">
                        <!-- TIPOS DE PRODUCTO -->
                        <div class="config-item">
                            <h4>üì¶ Tipos de Producto</h4>
                            <div class="config-list" id="tiposConfig"></div>
                            <div class="add-form">
                                <h5>‚ûï Agregar Nuevo Tipo</h5>
                                <div class="add-form-row">
                                    <input type="text" id="newTipoCode" placeholder="C√≥digo (ej: 6)" maxlength="1">
                                </div>
                                <div class="add-form-row">
                                    <input type="text" id="newTipoName" placeholder="Nombre del tipo">
                                </div>
                                <button class="btn btn-success btn-small" onclick="addConfigItem('tipos')">‚úÖ Agregar Tipo</button>
                            </div>
                        </div>

                        <!-- CATEGOR√çAS -->
                        <div class="config-item">
                            <h4>üìÇ Categor√≠as</h4>
                            <div class="config-list" id="categoriasConfig"></div>
                            <div class="add-form">
                                <h5>‚ûï Agregar Nueva Categor√≠a</h5>
                                <div class="add-form-row">
                                    <input type="text" id="newCategoriaCode" placeholder="C√≥digo (ej: 99)" maxlength="2">
                                </div>
                                <div class="add-form-row">
                                    <input type="text" id="newCategoriaName" placeholder="Nombre de la categor√≠a">
                                </div>
                                <button class="btn btn-success btn-small" onclick="addConfigItem('categorias')">‚úÖ Agregar Categor√≠a</button>
                            </div>
                        </div>

                        <!-- TALLAS -->
                        <div class="config-item">
                            <h4>üìè Tallas</h4>
                            <div class="config-list" id="tallasConfig"></div>
                            <div class="add-form">
                                <h5>‚ûï Agregar Nueva Talla</h5>
                                <div class="add-form-row">
                                    <input type="text" id="newTallaCode" placeholder="C√≥digo (ej: 08)" maxlength="2">
                                </div>
                                <div class="add-form-row">
                                    <input type="text" id="newTallaName" placeholder="Descripci√≥n de la talla">
                                </div>
                                <button class="btn btn-success btn-small" onclick="addConfigItem('tallas')">‚úÖ Agregar Talla</button>
                            </div>
                        </div>

                        <!-- COLORES -->
                        <div class="config-item">
                            <h4>üé® Colores</h4>
                            <div class="config-list" id="coloresConfig"></div>
                            <div class="add-form">
                                <h5>‚ûï Agregar Nuevo Color</h5>
                                <div class="add-form-row">
                                    <input type="text" id="newColorCode" placeholder="C√≥digo (ej: 16)" maxlength="2">
                                </div>
                                <div class="add-form-row">
                                    <input type="text" id="newColorName" placeholder="Nombre del color">
                                </div>
                                <button class="btn btn-success btn-small" onclick="addConfigItem('colores')">‚úÖ Agregar Color</button>
                            </div>
                        </div>

                        <!-- TEMPORADAS -->
                        <div class="config-item">
                            <h4>üóìÔ∏è Temporadas</h4>
                            <div class="config-list" id="temporadasConfig"></div>
                            <div class="add-form">
                                <h5>‚ûï Agregar Nueva Temporada</h5>
                                <div class="add-form-row">
                                    <input type="text" id="newTemporadaCode" placeholder="C√≥digo (ej: 0)" maxlength="1">
                                </div>
                                <div class="add-form-row">
                                    <input type="text" id="newTemporadaName" placeholder="Nombre de la temporada">
                                </div>
                                <button class="btn btn-success btn-small" onclick="addConfigItem('temporadas')">‚úÖ Agregar Temporada</button>
                            </div>
                        </div>

                        <!-- SUBCATEGOR√çAS -->
                        <div class="config-item">
                            <h4>üìã Gesti√≥n de Subcategor√≠as</h4>
                            <div class="form-group">
                                <label for="subcatCategorySelect">Seleccionar Categor√≠a:</label>
                                <select id="subcatCategorySelect" onchange="loadSubcategoriesForCategory()">
                                    <option value="">Seleccionar categor√≠a...</option>
                                </select>
                            </div>
                            <div id="subcategoryManagement" style="display: none;">
                                <div class="subcategory-section">
                                    <h5>Subcategor√≠as Existentes</h5>
                                    <div id="subcategoriesList"></div>
                                </div>
                                <div class="add-form">
                                    <h5>‚ûï Agregar Nueva Subcategor√≠a</h5>
                                    <div class="add-form-row">
                                        <input type="text" id="newSubcategoriaCode" placeholder="C√≥digo (ej: 7)" maxlength="1">
                                    </div>
                                    <div class="add-form-row">
                                        <input type="text" id="newSubcategoriaName" placeholder="Nombre de la subcategor√≠a">
                                    </div>
                                    <button class="btn btn-success btn-small" onclick="addSubcategory()">‚úÖ Agregar Subcategor√≠a</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB BASE DE DATOS -->
            <div id="database" class="tab-content">
                <div class="db-actions">
                    <h4>üóÑÔ∏è Gesti√≥n de Base de Datos</h4>
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="backupDatabase()">üíæ Crear Respaldo</button>
                        <button class="btn btn-warning" onclick="document.getElementById('restoreFile').click()">üìÇ Restaurar Respaldo</button>
                        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Limpiar Todo</button>
                        <button class="btn btn-primary" onclick="loadSampleData()">üìã Cargar Datos de Prueba</button>
                    </div>
                    <input type="file" id="restoreFile" style="display: none;" accept=".db,.sqlite,.json" onchange="restoreDatabase(event)">
                </div>

                <div class="config-section">
                    <h4>üìä Informaci√≥n de la Base de Datos</h4>
                    <div id="dbInfo">
                        <p>Cargando informaci√≥n...</p>
                    </div>
                </div>

                <div class="config-section">
                    <h4>üîß Consultas SQL Directas</h4>
                    <div style="margin-bottom: 15px;">
                        <textarea id="sqlQuery" rows="4" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="SELECT * FROM productos LIMIT 10;"></textarea>
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="executeSQLQuery()">‚ñ∂Ô∏è Ejecutar Consulta</button>
                        <button class="btn btn-warning" onclick="clearSQLResult()">üßπ Limpiar Resultado</button>
                    </div>
                    <div id="sqlResult" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PARA EDITAR PRODUCTOS -->
    <div id="editModal" class="modal">
        <div class="modal-content edit-modal">
            <div class="modal-header">
                <h2 class="modal-title">‚úèÔ∏è Editar Producto</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="form-grid">
                <div class="form-group">
                    <label for="editTipo">Tipo de Producto:</label>
                    <select id="editTipo" onchange="updateEditSubcategories()">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCategoria">Categor√≠a:</label>
                    <select id="editCategoria" onchange="updateEditSubcategories()">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editSubcategoria">Subcategor√≠a:</label>
                    <select id="editSubcategoria">
                        <option value="">Seleccionar categor√≠a primero...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTalla">Talla:</label>
                    <select id="editTalla">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editColor">Color:</label>
                    <select id="editColor">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTemporada">Temporada:</label>
                    <select id="editTemporada">
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editNombre">Nombre del Producto:</label>
                    <input type="text" id="editNombre" placeholder="Nombre ser√° generado autom√°ticamente">
                </div>
            </div>
            <div class="edit-actions">
                <button class="btn btn-success" onclick="updateProduct()">üíæ Guardar Cambios</button>
                <button class="btn btn-warning" onclick="closeEditModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PARA CONFIRMACI√ìN DE PRODUCTO DUPLICADO -->
    <div id="duplicateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ö†Ô∏è Producto Similar Encontrado</h2>
                <span class="close" onclick="closeDuplicateModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Ya existe un producto registrado con estas caracter√≠sticas:</strong>
                </div>
                <div id="duplicateProductInfo" style="margin: 20px 0;"></div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>Nuevo producto que desea crear:</strong>
                    <div id="newProductInfo" style="margin-top: 10px;"></div>
                </div>
                <p><strong>¬øDesea continuar y guardar este producto de todas formas?</strong></p>
            </div>
            <div class="edit-actions">
                <button class="btn btn-success" onclick="confirmSaveProduct()">‚úÖ S√≠, Guardar de todas formas</button>
                <button class="btn btn-danger" onclick="closeDuplicateModal()">‚ùå No, Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Cargar SQLite WASM -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
    
    <!-- Cargar scripts de la aplicaci√≥n -->
    <script src="database.js"></script>
    <script src="config.js"></script>
    <script src="products.js"></script>
    <script src="reports.js"></script>
    <script src="app.js"></script>
</body>
</html>